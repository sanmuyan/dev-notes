# 运维体系

## 运维规范

无规矩不成方圆，没有好的运维规范体系，技术体系就不会有好的健壮性，运维任务就不能复用，建立运维标准和流程更无从谈起。运维规范的好坏，决定了建立在它之上的运维体系的好坏。

### 操作规范

一个成熟的运维体系，不应该直接到环境中进行人工操作，应该通过配置系统去下发配置，或执行自动化任务。  
如果要到环境中操作需要遵循以下规范

- 使用非 `root` 用户操作
- 修改配置要先备份
- 查看日志文件要用 `less`

### 安全规范

- 网络访问端口暴露使用最小化访问原则
- 服务器操作要通过跳板机，修改配置要有记录
- 程序运行使用非 `root` 用户运行
- 无论内外部系统都要身份验证

### 开发规范

- 命名规范，项目名，应用名，接口名等都要有统一的命名规范
- 项目规范，项目结构应该有统一标准，项目依赖第三方应该尽量统一版本
- 约定规范，约定好健康检查的方式，日志打印的目录和文件格式

### 文档规范

要搭建起来文档体系，规范不能用口头约定，一定是要落在文档上的，最佳状况是用系统约束规范。

- 技术方案文档
- 项目方案文档
- 问题以及解决方案文档
- 日常操作文档

## 基础设施

- 对 Iass 层的选型，无论是 IDC 还是公有云，都要求 Iass 层是可配置的。
- 没有什么特殊原因 Pass 层直接上 K8s，K8s 已经是事实上的应用交付标准，配套生态也比较全

## 稳定性建设

稳定性体系的建设至关重要，稳定性建设要以数据为中心，通过监控、日志数据分析出系统的问题和潜在风险，并通过数据和数据可视化构建分层的可观测体系实时衡量系统运行状况。

### 基础设施可观测

通过监控数据构建 CPU、内存、存储资源池性能，构建网络和 I/O 流数据状态

- CPU 性能监控
- 内存性能监控
- 网络性能监控
- 存储容量监控
- I/O 性能监控

### 平台可观测

这里的平台一般是指以 `K8s` 为基础的容器平台

- 集群组件监控
- 集群事件监控
- 应用架构监控

### 应用可观测

以应用指标和应用日志数据构建出，

- 应用指标监控，包括 GC、连接池、线程池 情况
- 链路追踪，包括调用请求量统计、调用链路、应用依赖

### 业务可观测

- 接口监控，包括接口错误 接口请求
- 业务监控，包括支付数，下单数等
- 日志监控，包括了和业务指标的自定义业务数据

## 运维平台

运维平台是运维体系化的基础和入口

### 统一身份认证

要有一个给各个运维系统接入的统一身份验证系统，常用的有 `LDAP` `SSO` `oAutn`

### 运维系统

一个运维的基本功能，要能统一登录，要有工单审批让用户申请配置各种资源

### 应用运维

建立起应用运维体系，以应用程序为单元进行运维，包含应用开发、应用测试、应用调试、应用配置、应用部署、应用监控。

### 发布系统

作为应用运维中的一个重要系统，一般会独立出来，一个应用发布系统应该有以下能力：

- 用于构建和发布应用
- 可以设置发布窗口
- 抽象项目概念，项目中可以包含多个应用，可以对项目设置发布窗口和设置权限
- 发布流水线，比如测试环境成功发布，才能发布预发环境
- 发布审批功能

### 配置系统

管理基础设施配置的系统

- 管理环境配置
- 管理系统配置
- 管理中间件的配置

### 稳定性系统

一个稳定系统可以包含，性能告警、日志告警、告警处理

- 聚合多个类型的告警
- 对告警进行分组
- 升级认领机制
- 告警统计报表

### 自动化运维

把日常的系统运维任务整合起来，可以分为两大类任务类型：

- 手动触发任务，比如一键重启服务器
- 定时系统任务，比如清理日志
